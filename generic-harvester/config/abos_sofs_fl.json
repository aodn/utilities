{
    "db_params": {
        "driver": "postgresql+psycopg2",
        "database": "test_harvest",
        "host": "localhost",
        "port": "5432",
        "schema": "abos_sofs_fl",
        "user": "abos_sofs_fl",
        "password": "abos_sofs_fl"
    },
    "value_mappings": [{
        "table": "measurement",
        "dimensions": ["TIME"],
        "fields": {
            "TIME": {},
            "LATITUDE": {},
            "LONGITUDE": {},
            "PL_CMP": {},
            "WDIR": {},
            "WSPD": {},
            "WIND_H": {},
            "WIND_FLAG": {},
            "ATMP": {},
            "ATMP_H": {},
            "ATMP_FLAG": {},
            "AIRT": {},
            "AIRT_H": {},
            "AIRT_FLAG": {},
            "RELH": {},
            "RELH_H": {},
            "RELH_FLAG": {},
            "TEMP": {},
            "TEMP_H": {},
            "TEMP_FLAG": {},
            "RAIN_AMOUNT": {},
            "RAIN_AMOUNT_H": {},
            "RAIN_AMOUNT_FLAG": {},
            "SW": {},
            "SW_H": {},
            "SW_FLAG": {},
            "LW": {},
            "LW_H": {},
            "LW_FLAG": {},
            "HS": {},
            "HL": {},
            "H_RAIN": {},
            "TAU": {},
            "SST": {},
            "HEAT_NET": {},
            "MASS_NET": {},
            "LW_NET": {},
            "SW_NET": {},
            "WSPD10M": {},
            "AIRT1_5M": {},
            "AIRT2_0M": {},
            "RELH1_5M": {},
            "RELH2_0M": {}
        }
    }],
    "file_metadata": {
        "fields": {
            "deployment_number": {},
            "delivery_mode": {"value": "'RT' if re.match(r'.*Real-time.*', file.dest_path) else 'DM'"},
            "latitude": {"value": "dataset['LATITUDE'][(0)].item()"},
            "time_coverage_start": {"type": "datetime"},
            "time_coverage_end": {"type": "datetime"},
            "date_created": {"type": "datetime"}
        }
    },
    "aggregations": [{
        "table": "feature_metadata",
        "key": ["deployment_number"],
        "query": [
            "INSERT INTO feature_metadata",
            "  (deployment_number, mean_latitude, mean_longitude, geom, time_deployment_start, time_deployment_end)",
            "SELECT fm.deployment_number, avg(\"LATITUDE\"), avg(\"LONGITUDE\"),",
            "    st_geomfromtext('POINT(' || avg(\"LONGITUDE\") || ' ' || avg(\"LATITUDE\") || ')', 4326),",
            "    min(\"TIME\"), max(\"TIME\")",
            "  FROM file_metadata fm",
            "  JOIN measurement m ON (fm.file_id = m.file_id)",
            " WHERE \"LATITUDE\" > -60 AND \"LATITUDE\" < -30 AND \"LONGITUDE\" > 130 AND \"LONGITUDE\" < 160",
            "   AND deployment_number = :deployment_number",
            " GROUP BY deployment_number"
        ]
    }],
    "geonetwork_params": {
        "url": "http://localhost:8885/geonetwork/",
        "username": "admin",
        "password": "admin"
    },
    "metadata_updates": [
        {
            "uuid": "80ffbf9d-9547-41aa-8fa1-cf028c58556a",
            "spatial": {
                "table": "feature_metadata",
                "column": "geom",
                "resolution": 3
            },
            "temporal": {
                "table":  "measurement",
                "column": "TIME"
            },
            "vertical": {
                "relation": [
                    "(SELECT vertical_mins.value::real as vertical_min, vertical_maxs.value::real as vertical_max",
                    " FROM file_metadata fm",
                    " JOIN file_index.nc_global_attribute vertical_mins ON (fm.file_id = vertical_mins.file_id AND vertical_mins.name = 'geospatial_vertical_min')",
                    " JOIN file_index.nc_global_attribute vertical_maxs ON (fm.file_id = vertical_maxs.file_id AND vertical_maxs.name = 'geospatial_vertical_max')",
                    ")"
                ],
                "min_column": "vertical_min",
                "max_column": "vertical_max"
            }
        }
    ]
}