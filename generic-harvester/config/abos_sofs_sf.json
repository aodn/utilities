{
  "schema": "abos_sofs_fl",
  "user": "abos_sofs_fl",
  "password": "abos_sofs_fl",
  "tables": [
    {
      "name": "timeseries",
      "fields": {
        "id": {"type": "bigserial"},
        "deployment_number": {"type": "text"},

    {
      "name": "mean_latitude",
      "type": "real"
    },
    {
      "name": "mean_longitude",
      "type": "real"
    },
    {
      "name": "geom",
      "type": "geometry(Geometry,4326)",
      "check": "st_isvalid(geom)"
    },
    {
      "name": "time_deployment_start",
      "type": "timestamp with time zone"
    },
    {
      "name": "time_deployment_start",
      "type": "timestamp with time zone"
    }
    },
      "primary_key": ["id"],
      "indexes": [
        {
          "name": "timeseries_gist_idx",
          "type": "gist",
          "fields": ["geom"]
        }
      ],
      "update_key": "deployment_number",
      "actions": [
        {
          "event": "file_start",
          "action": "insert or update",
          "name": "timeseries",
          "values" : [
            {
              "name": "deployment_number",
              "value": "global_attribute.deployment_number"
            }
          ]
        },
        {
          "event": "file_end",
          "action": "update",
          "sql_values": {
            "select": [
              {
                "name": "deployment_number",
                "value": "deployment_number"
              },
              {
                "name": "mean_latitude",
                "value": "avg(\"LATITUDE\")"
              },
              {
                "name": "mean_longitude",
                "value": "avg(\"LONGITUDE\")"
              },
              {
                "name": "geom",
                "value": "st_geomfromtext('POINT(' || avg(\"LONGITUDE\")::text || ' ' || avg(\"LATITUDE\")::text || ')', 4326)"
              },
              {
                "name": "time_deployment_start",
                "value": "min(\"TIME\")"
              },
              {
                "name": "time_deployment_start",
                "value": "max(\"TIME\")"
              }
            ],
            "table_name": "measurement",
            "where": ["deployment_number={} and \"LATITUDE\" > -60 AND \"LATITUDE\" < -30 AND \"LONGITUDE\" > 130 AND \"LONGITUDE\" < 160", "global_attribute.deployment_number"],
            "group_by": ["deployment_number"]
          }
        }
      ]
    },
    {
      "name": "file_metadata",
      "fields": [
        {
          "name": "file_id",
          "type": "bigserial"
        },
        {
          "name": "deployment_number",
          "type": "text"
        },
        {
          "name": "delivery_mode",
          "type": "text"
        },
        {
          "name": "time_coverage_start",
          "type": "timestamp with time zone"
        },
        {
          "name": "time_coverage_end",
          "type": "timestamp with time zone"
        },
        {
          "name": "date_created",
          "type": "timestamp with time zone"
        }
      ],
      "actions": [
        {

          "name": "measurement",
          "variable_values": {

          }
        }
      ]
    }
  ],
  "metadata_updates": [
    {
      "uuid": "09319023093810983098",
      "spatial_table": "timeseries",
      "spatial_column": "geom",
      "spatial_resolution": 3
    }
  ]
}
